---
- hosts: all
  become: true
  vars:
    dns: 8.8.8.8

  tasks:
    - name: Setup Docker Daemon (1/2)
      copy:
        dest: /etc/resolvconf/resolv.conf.d/head
        content: |
                 # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
                 #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
                 nameserver {{ dns }}

    - name: Setup Docker Daemon (2/2)
      copy:
        dest: /etc/resolv.conf
        src: /etc/resolvconf/resolv.conf.d/head
        remote_src: yes

    - name: Restart Resolvconf
      systemd:
        state: restarted
        name: resolvconf

    - name: Restart Docker
      systemd:
        state: restarted
        name: docker
      ignore_errors: yes

